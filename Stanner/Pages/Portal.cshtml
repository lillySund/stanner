@page
@model Stanner.Pages.PortalModel
@{
    ViewData["Title"] = "Portal";
}

<div class="portal-container">
    <!-- Header Section -->
    <div class="portal-header">
        <h1>Welcome back, @Model.UserProfile?.DisplayName!</h1>
        <div class="user-stats">
            <div class="stat-card">
                <i class="bi bi-award"></i>
                <span class="stat-label">Level</span>
                <span class="stat-value">@Model.UserProfile?.Level</span>
            </div>
            <div class="stat-card">
                <i class="bi bi-star"></i>
                <span class="stat-label">Total XP</span>
                <span class="stat-value">@Model.UserProfile?.TotalXP</span>
            </div>
            <div class="stat-card">
                <i class="bi bi-book"></i>
                <span class="stat-label">Subjects</span>
                <span class="stat-value">@Model.Subjects.Count</span>
            </div>
            <div class="stat-card">
                <i class="bi bi-journal-text"></i>
                <span class="stat-label">Total Notes</span>
                <span class="stat-value">@Model.TotalNotes</span>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
            <a asp-page="/Subjects/Create" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add Subject
            </a>
            <a asp-page="/Flashcards/Study" class="btn btn-success">
                <i class="bi bi-lightning"></i> Study Flashcards
            </a>
            <a asp-page="/Skins/Shop" class="btn btn-info">
                <i class="bi bi-palette"></i> Skin Shop
            </a>
        </div>
    </div>

    <!-- Subjects Grid -->
    <div class="subjects-section">
        <div class="section-header">
            <h2>Your Subjects</h2>
            <a asp-page="/Subjects/Create" class="btn btn-sm btn-outline-primary">+ New Subject</a>
        </div>
        
        @if (Model.Subjects.Any())
        {
            <div class="subjects-grid">
                @foreach (var subject in Model.Subjects)
                {
                    <div class="subject-card" style="border-left: 4px solid @(subject.Color ?? "#6c757d")">
                        <div class="subject-header">
                            <h3>@subject.Name</h3>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-link" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" asp-page="/Subjects/Edit" asp-route-id="@subject.Id">Edit</a></li>
                                    <li><a class="dropdown-item" asp-page="/Subjects/Delete" asp-route-id="@subject.Id">Delete</a></li>
                                </ul>
                            </div>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(subject.Description))
                        {
                            <p class="subject-description">@subject.Description</p>
                        }
                        
                        <div class="grade-info">
                            @if (!string.IsNullOrEmpty(subject.CurrentGrade) || !string.IsNullOrEmpty(subject.TargetGrade))
                            {
                                <div class="grades">
                                    @if (!string.IsNullOrEmpty(subject.CurrentGrade))
                                    {
                                        <span class="badge bg-secondary">Current: @subject.CurrentGrade</span>
                                    }
                                    @if (!string.IsNullOrEmpty(subject.TargetGrade))
                                    {
                                        <span class="badge bg-success">Target: @subject.TargetGrade</span>
                                    }
                                </div>
                            }
                        </div>
                        
                        <div class="subject-stats">
                            <div class="stat">
                                <i class="bi bi-journal"></i>
                                <span>@subject.Notes.Count Notes</span>
                            </div>
                            <div class="stat">
                                <i class="bi bi-card-text"></i>
                                <span>@subject.Flashcards.Count Flashcards</span>
                            </div>
                        </div>
                        
                        <div class="subject-actions">
                            <a asp-page="/Notes/Index" asp-route-subjectId="@subject.Id" class="btn btn-sm btn-outline-primary">View Notes</a>
                            <a asp-page="/Flashcards/Index" asp-route-subjectId="@subject.Id" class="btn btn-sm btn-outline-success">Flashcards</a>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="empty-state">
                <i class="bi bi-book" style="font-size: 3rem; color: #ccc;"></i>
                <p>No subjects yet. Create your first subject to get started!</p>
                <a asp-page="/Subjects/Create" class="btn btn-primary">Create Subject</a>
            </div>
        }
    </div>

    <!-- Study Progress Today -->
    <div class="daily-progress">
        <h2>Today's Progress</h2>
        <div class="progress-card">
            <i class="bi bi-calendar-check"></i>
            <div>
                <p class="progress-label">Flashcards Studied</p>
                <p class="progress-value">@Model.FlashcardsStudiedToday</p>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .portal-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .portal-header {
            margin-bottom: 2rem;
        }
        
        .portal-header h1 {
            margin-bottom: 1.5rem;
            color: #333;
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .quick-actions {
            margin-bottom: 2rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .action-buttons .btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .subjects-section {
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .subject-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .subject-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }
        
        .subject-header h3 {
            margin: 0;
            font-size: 1.25rem;
        }
        
        .subject-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .grade-info {
            margin-bottom: 1rem;
        }
        
        .grades {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .subject-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.75rem 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        
        .subject-stats .stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .subject-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .empty-state p {
            margin: 1rem 0;
        }
        
        .daily-progress {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .progress-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .progress-card i {
            font-size: 2.5rem;
            color: #28a745;
        }
        
        .progress-label {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .progress-value {
            margin: 0;
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }
    </style>
}
